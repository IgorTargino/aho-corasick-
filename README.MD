# **Aho-Corasick String Matching Algorithm - Sistema Embarcado** ğŸ”

[![C](https://img.shields.io/badge/Language-C-blue.svg)](https://en.wikipedia.org/wiki/C_(programming_language))
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Memory](https://img.shields.io/badge/Memory-8KB_Limit-orange.svg)](#memory-requirements)
[![Build](https://img.shields.io/badge/Build-Make-red.svg)](#compilaÃ§Ã£o-e-execuÃ§Ã£o)

Uma implementaÃ§Ã£o otimizada do algoritmo **Aho-Corasick** para detecÃ§Ã£o de mÃºltiplos padrÃµes de texto simultaneamente, projetada especificamente para **sistemas embarcados** com restriÃ§Ãµes rigorosas de memÃ³ria (8KB).

## **ğŸ“‹ Ãndice**

- [Sobre o Algoritmo](#sobre-o-algoritmo)
- [CaracterÃ­sticas da ImplementaÃ§Ã£o](#caracterÃ­sticas-da-implementaÃ§Ã£o)
- [Arquitetura do Sistema](#arquitetura-do-sistema)
- [Requisitos de MemÃ³ria](#requisitos-de-memÃ³ria)
- [ConfiguraÃ§Ã£o e InstalaÃ§Ã£o](#configuraÃ§Ã£o-e-instalaÃ§Ã£o)
- [CompilaÃ§Ã£o e ExecuÃ§Ã£o](#compilaÃ§Ã£o-e-execuÃ§Ã£o)
- [Uso da API](#uso-da-api)
- [Casos de Teste](#casos-de-teste)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Exemplos de Uso](#exemplos-de-uso)
- [Performance](#performance)
- [LimitaÃ§Ãµes](#limitaÃ§Ãµes)
- [ContribuiÃ§Ã£o](#contribuiÃ§Ã£o)
- [LicenÃ§a](#licenÃ§a)

## **ğŸ§  Sobre o Algoritmo**

O **Aho-Corasick** Ã© um algoritmo de busca de strings que permite encontrar todas as ocorrÃªncias de mÃºltiplos padrÃµes em um texto de forma eficiente. Ã‰ amplamente utilizado em:

- **Filtros de conteÃºdo** (spam, malware, palavras proibidas)
- **Sistemas de detecÃ§Ã£o de intrusÃ£o** (IDS)
- **AnÃ¡lise de logs** e monitoramento
- **Processamento de texto** em tempo real

### **Complexidade AlgorÃ­tmica**
- **PrÃ©-processamento:** O(Î£|padrÃµes|) - construÃ§Ã£o do autÃ´mato
- **Busca:** O(|texto| + |ocorrÃªncias|) - busca no texto
- **EspaÃ§o:** O(Î£|padrÃµes|) - memÃ³ria para o autÃ´mato

## **âœ¨ CaracterÃ­sticas da ImplementaÃ§Ã£o**

### **ğŸ¯ Otimizada para Sistemas Embarcados**
- **Limite rigoroso de 8KB** de memÃ³ria total
- **Sem alocaÃ§Ã£o dinÃ¢mica** - apenas arrays estÃ¡ticos
- **ConfiguraÃ§Ã£o em tempo de compilaÃ§Ã£o**
- **Overhead mÃ­nimo** de processamento

### **ğŸ”§ Funcionalidades**
- âœ… **Busca case-insensitive** (A-Z, a-z)
- âœ… **MÃºltiplos padrÃµes simultÃ¢neos** (atÃ© 30 padrÃµes)
- âœ… **Callback customizÃ¡vel** para matches
- âœ… **ValidaÃ§Ã£o robusta** de entrada
- âœ… **Debug condicional** (removÃ­vel em produÃ§Ã£o)
- âœ… **API simples e intuitiva**

### **âš¡ OtimizaÃ§Ãµes**
- **Mapeamento inline** de caracteres
- **InicializaÃ§Ã£o eficiente** com `memset`
- **VerificaÃ§Ãµes de limites** em tempo de compilaÃ§Ã£o
- **TransiÃ§Ãµes prÃ©-computadas** para busca rÃ¡pida

## **ğŸ—ï¸ Arquitetura do Sistema**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Aho-Corasick System                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer (main.c)                                â”‚
â”‚  â”œâ”€ Content Filter                                         â”‚
â”‚  â”œâ”€ Pattern Management                                     â”‚
â”‚  â””â”€ Memory Usage Monitoring                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Layer (aho_corasick.h)                               â”‚
â”‚  â”œâ”€ ac_initialize_automaton()                             â”‚
â”‚  â”œâ”€ ac_add_pattern()                                       â”‚
â”‚  â”œâ”€ ac_build_automaton()                                   â”‚
â”‚  â””â”€ ac_search()                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Implementation (aho_corasick.c)                     â”‚
â”‚  â”œâ”€ Trie Construction                                      â”‚
â”‚  â”œâ”€ Failure Link Computation                              â”‚
â”‚  â”œâ”€ Go Function (Transitions)                             â”‚
â”‚  â””â”€ Pattern Matching Engine                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Supporting Components                                      â”‚
â”‚  â”œâ”€ Queue (aho_queue.c) - BFS for construction            â”‚
â”‚  â””â”€ Configuration (aho_config.h) - Memory limits          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## **ğŸ’¾ Requisitos de MemÃ³ria**

### **OrÃ§amento Total: 8KB (8192 bytes)**

| Componente | Tamanho | DescriÃ§Ã£o |
|------------|---------|-----------|
| **AutÃ´mato Principal** | ~7130B | Estrutura `ac_automaton_t` |
| **Buffer de Entrada** | 512B | Texto para anÃ¡lise |
| **Buffers Auxiliares** | 256B | Outros usos da aplicaÃ§Ã£o |
| **Margem de SeguranÃ§a** | ~294B | Stack e variÃ¡veis locais |

### **Detalhamento do AutÃ´mato (7130 bytes)**

```c
// CÃ¡lculo detalhado de memÃ³ria:
VÃ©rtices: 30 * 229 bytes = 6870 bytes
â”œâ”€ next[26]: 26 * 4 = 104 bytes por vÃ©rtice
â”œâ”€ go[26]: 26 * 4 = 104 bytes por vÃ©rtice  
â”œâ”€ link: 4 bytes por vÃ©rtice
â”œâ”€ output: 1 byte por vÃ©rtice
â”œâ”€ pattern_indices[2]: 2 * 4 = 8 bytes por vÃ©rtice
â””â”€ num_patterns_at_vertex: 4 bytes por vÃ©rtice
   + padding: ~4 bytes por vÃ©rtice

PadrÃµes: 30 * 4 bytes = 120 bytes (ponteiros)
Fila BFS: 30 * 4 + 12 bytes = 132 bytes
Controle: 2 * 4 bytes = 8 bytes

Total: 6870 + 120 + 132 + 8 = 7130 bytes
```

### **ConfiguraÃ§Ã£o de Limites**

```c
#define AC_MAX_VERTICES             30    // MÃ¡ximo de vÃ©rtices
#define AC_MAX_PATTERNS             30    // MÃ¡ximo de padrÃµes  
#define AC_MAX_PATTERNS_PER_VERTEX  2     // PadrÃµes por vÃ©rtice
#define AC_K_ALPHABET_SIZE          26    // A-Z, a-z
```

## **âš™ï¸ ConfiguraÃ§Ã£o e InstalaÃ§Ã£o**

### **PrÃ©-requisitos**
- **GCC** (ou compilador C compatÃ­vel)
- **Make** (para automaÃ§Ã£o de build)
- **Sistema Linux/Unix** (testado em Ubuntu/Debian)

### **Clone do RepositÃ³rio**
```bash
git clone <repository-url>
cd aho-corasick
```

### **Estrutura de DiretÃ³rios**
```
aho-corasick/
â”œâ”€â”€ include/          # CabeÃ§alhos (.h)
â”‚   â”œâ”€â”€ aho_corasick.h
â”‚   â”œâ”€â”€ aho_queue.h
â”‚   â””â”€â”€ aho_config.h
â”œâ”€â”€ src/              # CÃ³digo fonte (.c)
â”‚   â”œâ”€â”€ main.c
â”‚   â”œâ”€â”€ aho_corasick.c
â”‚   â”œâ”€â”€ aho_queue.c
â”‚   â””â”€â”€ test_aho_corasick.c
â”œâ”€â”€ build/            # Arquivos compilados (gerado)
â”œâ”€â”€ Makefile          # AutomaÃ§Ã£o de build
â””â”€â”€ README.md         # Esta documentaÃ§Ã£o
```

## **ğŸ”¨ CompilaÃ§Ã£o e ExecuÃ§Ã£o**

### **Comandos DisponÃ­veis**

```bash
# CompilaÃ§Ã£o
make debug          # VersÃ£o debug (com logs detalhados)
make release        # VersÃ£o otimizada (produÃ§Ã£o)
make test           # Compila suite de testes

# ExecuÃ§Ã£o
make run            # Executa aplicaÃ§Ã£o (modo debug)
make run_release    # Executa aplicaÃ§Ã£o (modo release)
make run_test       # Executa todos os testes

# Limpeza
make clean          # Remove arquivos compilados
```

### **Exemplo de Uso BÃ¡sico**

```bash
# Compilar e executar filtro de conteÃºdo
make run

# SaÃ­da esperada:
=== Filtro de Conteudo - Aho-Corasick ===

Configurando filtro de conteudo...
  âœ… Padrao adicionado: "spam"
  âœ… Padrao adicionado: "virus"
  âœ… Padrao adicionado: "hack"
  ...

âœ… Automato construido com sucesso!

--- Estimativa de Uso de Memoria ---
  Automato (ac_automaton_t): 7130 bytes
  Total estimado: 7898 bytes (7.71 KB)
  âœ… Dentro do orcamento de memoria

=== Teste do Filtro de Conteudo ===
[1] Analisando: "esta e uma mensagem normal e segura"
    âœ… Resultado: Mensagem Permitida

[2] Analisando: "alerta um virus foi detectado"
    ğŸš« Resultado: MENSAGEM BLOQUEADA!
```

### **Executando Testes**

```bash
make run_test

# SaÃ­da esperada:
=== SUITE DE TESTES - AHO-CORASICK ===

[TEST 1] Inicializacao do Automato
  âœ… PASS: Root vertex deve ser criado
  âœ… PASS: Nenhum padrao inicial

[TEST 2] Adicao de Padroes
  âœ… PASS: Deve adicionar padrao valido
  âœ… PASS: Deve rejeitar padrao vazio

...

=== RESUMO DOS TESTES ===
Total de testes: 14
Testes passaram: 45
Testes falharam: 0
Taxa de sucesso: 100.0%
âœ… TODOS OS TESTES PASSARAM
```

## **ğŸ“š Uso da API**

### **InicializaÃ§Ã£o**

```c
#include "aho_corasick.h"

// Criar e inicializar autÃ´mato
ac_automaton_t automaton;
ac_initialize_automaton(&automaton);
```

### **AdiÃ§Ã£o de PadrÃµes**

```c
// Adicionar padrÃµes (antes de construir o autÃ´mato)
bool success1 = ac_add_pattern(&automaton, "spam");
bool success2 = ac_add_pattern(&automaton, "virus");
bool success3 = ac_add_pattern(&automaton, "malware");

// Verificar se foram adicionados com sucesso
if (!success1 || !success2 || !success3) {
    printf("Erro ao adicionar alguns padrÃµes\n");
}
```

### **ConstruÃ§Ã£o do AutÃ´mato**

```c
// Construir autÃ´mato (apÃ³s adicionar todos os padrÃµes)
ac_build_automaton(&automaton);

// Validar se foi construÃ­do corretamente
if (!ac_is_built(&automaton)) {
    printf("Erro: Falha na construÃ§Ã£o do autÃ´mato\n");
    return -1;
}
```

### **ImplementaÃ§Ã£o do Callback**

```c
// Callback chamado quando um padrÃ£o Ã© encontrado
void ac_set_match_callback(const char* pattern, int position) {
    printf("PadrÃ£o '%s' encontrado na posiÃ§Ã£o %d\n", pattern, position);
    
    // Sua lÃ³gica aqui (ex: logging, bloqueio, etc.)
    take_action_on_forbidden_content(pattern, position);
}
```

### **Busca em Texto**

```c
// Buscar padrÃµes no texto
const char* text = "Esta mensagem contÃ©m spam e virus";
ac_search(&automaton, text);

// O callback serÃ¡ chamado automaticamente para cada match
```

### **Monitoramento de Recursos**

```c
// Verificar uso de recursos
printf("VÃ©rtices utilizados: %d/%d\n", 
       ac_get_vertex_count(&automaton), AC_MAX_VERTICES);
       
printf("PadrÃµes carregados: %d/%d\n",
       ac_get_pattern_count(&automaton), AC_MAX_PATTERNS);

printf("MemÃ³ria estimada: %zu bytes\n", sizeof(ac_automaton_t));
```

## **ğŸ§ª Casos de Teste**

### **Cobertura de Testes**

| Categoria | Testes | DescriÃ§Ã£o |
|-----------|--------|-----------|
| **InicializaÃ§Ã£o** | 3 testes | Estado inicial, alocaÃ§Ã£o de root |
| **AdiÃ§Ã£o de PadrÃµes** | 8 testes | PadrÃµes vÃ¡lidos/invÃ¡lidos, limites |
| **ConstruÃ§Ã£o** | 4 testes | AutÃ´mato vazio/com padrÃµes |
| **Busca BÃ¡sica** | 6 testes | PadrÃ£o Ãºnico, mÃºltiplos padrÃµes |
| **Case Sensitivity** | 3 testes | MaiÃºsculas/minÃºsculas |
| **Casos Extremos** | 8 testes | Caracteres invÃ¡lidos, texto vazio |
| **Performance** | 5 testes | PadrÃµes sobrepostos, repetidos |
| **MemÃ³ria** | 4 testes | Uso de recursos, limites |

### **Testes de Limite**

```c
// Teste de limite de padrÃµes
void test_pattern_limit() {
    // Adiciona AC_MAX_PATTERNS + 5 padrÃµes
    // Verifica que apenas AC_MAX_PATTERNS sÃ£o aceitos
}

// Teste de limite de vÃ©rtices  
void test_vertex_limit() {
    // Adiciona padrÃµes muito longos
    // Verifica que nÃ£o excede AC_MAX_VERTICES
}
```

### **Testes de Funcionalidade**

```c
// Teste de busca com padrÃµes sobrepostos
void test_multiple_patterns_search() {
    // PadrÃµes: "he", "she", "his", "hers"
    // Texto: "ushers"
    // Deve encontrar: "he", "she", "hers"
}

// Teste case-insensitive
void test_case_insensitive_search() {
    // PadrÃ£o: "test"
    // Texto: "TEST", "Test", "tEsT"
    // Deve encontrar em todos os casos
}
```

## **ğŸ“ Estrutura do Projeto**

### **Arquivos Principais**

| Arquivo | DescriÃ§Ã£o |
|---------|-----------|
| `include/aho_corasick.h` | API principal e estruturas |
| `src/aho_corasick.c` | ImplementaÃ§Ã£o core do algoritmo |
| `src/main.c` | AplicaÃ§Ã£o de exemplo (filtro de conteÃºdo) |
| `src/test_aho_corasick.c` | Suite completa de testes |
| `include/aho_queue.h` | Fila para construÃ§Ã£o BFS |
| `src/aho_queue.c` | ImplementaÃ§Ã£o da fila |

### **Arquivos de ConfiguraÃ§Ã£o**

| Arquivo | DescriÃ§Ã£o |
|---------|-----------|
| `Makefile` | AutomaÃ§Ã£o de build e testes |
| `include/aho_config.h` | ConfiguraÃ§Ãµes de limite de memÃ³ria |

## **ğŸ’¡ Exemplos de Uso**

### **1. Filtro de Spam Simples**

```c
#include "aho_corasick.h"

volatile bool is_spam = false;

void ac_set_match_callback(const char* pattern, int position) {
    is_spam = true;
    printf("Spam detectado: '%s'\n", pattern);
}

bool check_email(const char* content) {
    static ac_automaton_t spam_filter;
    static bool initialized = false;
    
    if (!initialized) {
        ac_initialize_automaton(&spam_filter);
        ac_add_pattern(&spam_filter, "viagra");
        ac_add_pattern(&spam_filter, "casino");
        ac_add_pattern(&spam_filter, "lottery");
        ac_build_automaton(&spam_filter);
        initialized = true;
    }
    
    is_spam = false;
    ac_search(&spam_filter, content);
    return !is_spam;
}
```

### **2. Detector de Malware em Logs**

```c
void setup_malware_detector(ac_automaton_t* detector) {
    ac_initialize_automaton(detector);
    
    // Assinaturas de malware conhecidas
    ac_add_pattern(detector, "trojan");
    ac_add_pattern(detector, "rootkit"); 
    ac_add_pattern(detector, "backdoor");
    ac_add_pattern(detector, "keylogger");
    
    ac_build_automaton(detector);
}

void analyze_log_line(ac_automaton_t* detector, const char* log_line) {
    ac_search(detector, log_line);
    // Callback irÃ¡ processar detecÃ§Ãµes
}
```

### **3. Filtro de ConteÃºdo para Chat**

```c
bool is_message_appropriate(const char* message) {
    static ac_automaton_t content_filter;
    static bool filter_ready = false;
    
    if (!filter_ready) {
        ac_initialize_automaton(&content_filter);
        
        // Palavras proibidas
        ac_add_pattern(&content_filter, "hate");
        ac_add_pattern(&content_filter, "violence");
        ac_add_pattern(&content_filter, "inappropriate");
        
        ac_build_automaton(&content_filter);
        filter_ready = true;
    }
    
    global_violation_found = false;
    ac_search(&content_filter, message);
    
    return !global_violation_found;
}
```

## **âš¡ Performance**

### **Complexidade Real**

```c
// Para N padrÃµes de tamanho mÃ©dio M:
PrÃ©-processamento: O(N * M)
Busca em texto T: O(|T| + nÃºmero_de_matches)
MemÃ³ria: O(N * M) limitada por AC_MAX_VERTICES
```

## **âš ï¸ LimitaÃ§Ãµes**

### **LimitaÃ§Ãµes de Design**

1. **Alfabeto Restrito**: Apenas A-Z, a-z (26 caracteres)
2. **MemÃ³ria Fixa**: 8KB total, nÃ£o expansÃ­vel
3. **Sem Unicode**: NÃ£o suporta caracteres especiais/acentos
4. **Arrays EstÃ¡ticos**: Sem alocaÃ§Ã£o dinÃ¢mica

### **LimitaÃ§Ãµes Operacionais**

| Limite | Valor | ConfigurÃ¡vel |
|--------|-------|--------------|
| **MÃ¡ximo de vÃ©rtices** | 30 | âœ… `AC_MAX_VERTICES` |
| **MÃ¡ximo de padrÃµes** | 30 | âœ… `AC_MAX_PATTERNS` |
| **PadrÃµes por vÃ©rtice** | 2 | âœ… `AC_MAX_PATTERNS_PER_VERTEX` |
| **Tamanho do alfabeto** | 26 | âœ… `AC_K_ALPHABET_SIZE` |

### **Quando NÃƒO Usar**

- **Textos com Unicode/UTF-8** (acentos, caracteres especiais)
- **Sistemas com > 1000 padrÃµes** (limite de memÃ³ria)
- **PadrÃµes muito longos** (podem esgotar vÃ©rtices)
- **AplicaÃ§Ãµes que requerem regex** (apenas matching exato)

## **ğŸ”§ ConfiguraÃ§Ã£o AvanÃ§ada**

### **Ajustando Limites de MemÃ³ria**

```c
// No arquivo aho_corasick.h, ajuste conforme necessÃ¡rio:

// Para mais padrÃµes (consome mais memÃ³ria):
// Para padrÃµes mais longos (consome mais vÃ©rtices):
#define AC_MAX_PATTERNS 50
#define AC_MAX_VERTICES 100

// Para mÃºltiplos padrÃµes por final de palavra:
#define AC_MAX_PATTERNS_PER_VERTEX 5
```

### **Habilitando Debug**

```bash
# CompilaÃ§Ã£o com debug detalhado
make debug

# Ou definir manualmente:
gcc -DAC_DEBUG_PRINTS ...
```

### **OtimizaÃ§Ã£o para ProduÃ§Ã£o**

```bash
# CompilaÃ§Ã£o otimizada (sem debug)
make release

# Flags aplicadas automaticamente:
# -O2 (otimizaÃ§Ã£o de performance)
# Sem -DAC_DEBUG_PRINTS (remove logs)
```

## **ğŸ“„ LicenÃ§a**

Este projeto estÃ¡ licenciado sob a **MIT License** - veja o arquivo [LICENSE](LICENSE) para detalhes.

---